
@{
    ViewBag.Title = "Index";
    Layout = null;
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
@*<script src="~/Scripts/jquery-1.9.1.min.js"></script>*@
@*<script src="~/Scripts/jquery-1.10.2.js"></script>*@
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery-ui-1.10.2.min.js"></script>
<script src="~/Scripts/jtable/jquery.jtable.js"></script>
@*<script src="~/Scripts/jquery-ui-1.10.2.min.js"></script>*@
<link href="http://jtable.org/Content/themes/metroblue/jquery-ui.css" rel="stylesheet" type="text/css" />
<script src="~/Scripts/jtable/external/json2.js" type="text/javascript"></script>

<script src="~/Scripts/jtable/jquery.jtable.js" type="text/javascript"></script>
<script src="~/Scripts/jtable/extensions/jquery.jtable.aspnetpagemethods.js"
        type="text/javascript"></script>

<link href="~/Scripts/jtable/themes/metro/blue/jtable.min.css" rel="stylesheet" />
<input type="button" id="btnCreateCustomer" value="Create Customer" />





<fieldset>
    <legend>Filters:</legend>
    <table class="border01" style="width: 100%;">
        <tr>
            <td align="right">
                Customer Code:
            </td>
            <td>
                <input type="text" id="txtCustomerCode">
            </td>
            <td align="right">
                Company Name:
            </td>
            <td>
                <input type="text" id="txtCompanyName">
            </td>
        </tr>
        
        <tr>
            <td align="right">
                Contact Name:
            </td>
            <td>
                <input type="text" id="txtContactName"> 
            </td>
            <td align="right">
                Phone
            </td>
            <td>
                <input type="text" id="txtPhone">
               
            </td>
        </tr>
        <tr>
            <td align="right">
                Country:
            </td>
            <td>
                <select id='ddlCountrySearch'></select>  
            </td>
            <td align="right">
                State:
            </td>
            <td>
                <select id='ddlStateSearch'></select>    
            </td>
        </tr>

        <tr>
            <td align="right">
                City
            </td>
            <td><select id='ddlCitySearch'></select>  </td>
            <td align="right">
                Postal Code:
            </td>
            <td><input type="text" id="txtPostalCode"></td>
        </tr>


        <tr>
            <td align="right">
                From Date:
            </td>
            <td><input type="text" id="txtFromDate"></td>
            <td align="right">
                To Date:
            </td>
            <td><input type="text" id="txtToDate"></td>
        </tr>

        <tr>
            <td align="center" colspan="4">
                <input type="button" id="btnSearch" value="Search" />
                &nbsp;
                <input type="button" id="btnReset" value="Clear" />
            </td>
            
            <td align="right" valign="bottom"></td>
        </tr>
    </table>
</fieldset>
<div style="height:20px;"></div>
    <div id="dvCustomer" style="width:1200px; margin-left:70px;"></div>

    <div id="dvGlobalPopUp"></div>

<script>
    $(document).ready(function () {
  
        $("#btnCreateCustomer").click(function () {

        openCustomerDetailPop(0);
    });

    });

</script>


    <script type="text/javascript">

        function openCustomerDetailPop(CustomerID) {

            //, Address, CompanyName, ContactName, City, CustomerBarCode, CustomerCode, ContactTitle, Region
            //ID: TicketID
            var $DDLCountry = "<select id='ddlcountry'></select>";
            var $DDLState = "<select id='ddlstate'></select>";
            var $DDLCity = "<select id='ddlcity'></select>";

            var $ticketDetail = $('<div id="ticketDetailForward">Loading...</div>');
            var $openCustomerDetailPop = $('<div id="divticketDetailPopup">' +

            '<div  style="height:6px;">' + '</div>' +

            ' <table style="border:1px solid #c6d0da; width: 100%;" cellpadding="5">' +
                                                '<tr><td style="width:180px;"><label><b>CustomerCode:&nbsp;</b></label></td>' +

                                                    '<td colspan="3"><input type="text" id="txtCustomerCode"></td>' +

                                                    '<td><label><b>CustomerBarCode.:&nbsp;</b></label></td>' +

                                                     '<td ><input type="text" id="txtCustomerBarCode"></td>' +
                                                      '</tr>' +
                                                '<tr> <td style="width:130px;"><label><b>CompanyName:&nbsp;</b></label></td>' +

                                                    '<td colspan="3"><input type="text" id="txtCompanyName"></td>' +
                                                    '<td style="width:130px;"><label><b> ContactName:&nbsp;</b></label></td>' +
                                                     '<td><input type="text" id="txtContactName"></td>' +
                                                '</tr>' +

                                                '<tr><td><label><b> ContactTitle:&nbsp;</b></label></td>' +
                                                '<td colspan="3"><input type="text" id="txtContactTitle"></td>' +

                                               ' <td style="width:130px;"><label><b> Phone:&nbsp;</b></label><span class="mandatory"></span></td>' +

                                                 '<td><input type="text" id="txtPhone"></td>' +

                                                '</tr>' +

                                              '</table>' +
                                                 '<div class="clear10"></div>' +
                                                   '<table style="border:1px solid #c6d0da; width: 100%;" cellpadding="5">' +

                                                     '<tr>' +

                                                    '<td style="width:130px;"><label><b>Address:&nbsp;</b></label></td>' +

                                                    '<td colspan="3"><input type="text" style="width:300px; height:80px;" id="txtAddress"></td>' +
                                                    '<td><label><b>Region:&nbsp;</b></label></td>' +

                                                   '<td><input type="text" id="txtRegion"></td>' +

                                                '</tr>' +

                                                     '</table>' +

                                               '<div class="clear10"></div>' +

                                               '<div id="divMain1" style="font-weight: bold; color:red;">' + '</div>' +

                                               '<div class="clear10"></div>' +

                                               '<table style="border:1px solid #c6d0da; width: 100%; padding:5px;">' +
                                               '<tr><td colspan="2"><label><b>Country:&nbsp;</b></label><span class="mandatory"></span></td>' +

                                                '<td >' + $DDLCountry + '</td>' +

                                                '<td colspan="2"><label><b>State:&nbsp;</b></label><span class="mandatory"></span></td>' +

                                             '<td >' + $DDLState + '</td>' +

                                            '</tr>' +

                                            '<tr><td colspan="2"><label><b>City:&nbsp;</b></label><span class="mandatory"></span></td>' +

                                                '<td >' + $DDLCity + '</td>' +
                                                '<td colspan="2"><label><b>PostalCode:&nbsp;</b></label><span class="mandatory"></span></td>' +

                                                '<td ><input type="text" id="txtPostalCode"></td>' +


                                            '</tr>' +
                                                 '<tr><td>&nbsp;</td>' +

                                                 '<td colspan="2"><div id="dvMessage" style="display:none; width:500px;text-align:center;"></div></td>' +

                                                '</tr>' +


                                              '</table>' +

                                               '<div class="clear10"></div>' +

                                               '<div id="divMain1" style="font-weight: bold; color:red;">' + '</div>' +

                                               '<div class="clear10"></div>' +

                                               '<table style="border:1px solid #c6d0da; width: 100%; padding:5px;">' +

                                                '<tr><td>&nbsp;</td>' +
                                                 '<td colspan="2"><div style="width:500px;margin-left:300px;">' +
                                                 '<input type="button" id="btnSubmit" value="Submit"/></td></div>' +

                                                '</tr>' +

                                              '</table>' +


                                             '<div  style="height:6px;">' + '</div>' +

                                '</div>');

            //--------------------------------------------

            //    var $ddlStatus = "<select id='ddlForwarded' class='inputDDL'>";
            //    $ddlStatus = $ddlStatus + "<option value='2'>Forward</option>";
            //    $ddlStatus = $ddlStatus + "<option value='3'>Resolved</option>";
            //    $ddlStatus = $ddlStatus + "<option value='4'>Closed</option>";
            //    $ddlStatus = $ddlStatus + "</select>";
            //    $openCustomerDetailPop.find('#SelectStatus').append($ddlStatus);



            //--bind Non Tickets Details to pop-up
            $('#dvGlobalPopUp').append($ticketDetail);

            $.ajax({
                type: "Get",
                url: 'Customer/GetCustomer',
                data: "CustomerID=" + CustomerID,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                responseType: "json",
                success: function (data) {
                    if (CustomerID == 0) {
                        $ticketDetail.empty();
                        bindCountries($openCustomerDetailPop.find('#ddlcountry'), 0);
                        $ticketDetail.append($openCustomerDetailPop);
                    }

                    else {

                        $ticketDetail.empty();

                        $openCustomerDetailPop.find('#txtCompanyName').val(data.Records.CompanyName);
                        $openCustomerDetailPop.find('#txtCustomerBarCode').val(data.Records.CustomerBarCode);
                        $openCustomerDetailPop.find('#txtCustomerCode').val(data.Records.CustomerCode);
                        $openCustomerDetailPop.find('#txtContactName').val(data.Records.ContactName);
                        $openCustomerDetailPop.find('#txtContactTitle').val(data.Records.ContactTitle);

                        $openCustomerDetailPop.find('#txtRegion').val(data.Records.Region);

                        $openCustomerDetailPop.find('#txtPostalCode').val(data.Records.PostalCode);
                        $openCustomerDetailPop.find('#txtPhone').val(data.Records.Phone);
                        $openCustomerDetailPop.find('#txtAddress').val(data.Records.Address);

                        bindCountries($openCustomerDetailPop.find('#ddlcountry'), data.Records.Country);
                        bindStateForEdit($openCustomerDetailPop.find('#ddlstate'), data.Records.Country, data.Records.State)
                        bindCityForEdit($openCustomerDetailPop.find('#ddlcity'), data.Records.State, data.Records.City)
                        //$openCustomerDetailPop.find('#Status').attr('disabled', 'disabled');

                        $ticketDetail.append($openCustomerDetailPop);
                    }
                },
                error: function (result) {
                    $ticketDetail.html('Server communication error occurred.');
                }
            });

            $('#dvGlobalPopUp').find('#ticketDetailForward').dialog({
                modal: true,
                closeOnEscape: true,
                title: 'Customer Details :',
                resizable: false,
                draggable: false,
                height: 'auto',
                width: '900',
                position: ['top', 50],
                beforeclose: function () {
                    //To do on close
                },
                close: function () {
                    //To do on close
                    $ticketDetail.remove();
                }
            });

            //$openCustomerDetailPop.find('#ddldept').focus();
            //butto event
            $openCustomerDetailPop.find('#ddlcountry').change(function () {
                var option = this.options[this.selectedIndex];
                var cId = $(option).val();              
                $.ajax({
                    type: "Get",
                    url: 'Customer/GetStatesName',
                    data: "CountryID=" + cId,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    responseType: "json",
                    success: function (data) {
                        $openCustomerDetailPop.find('#ddlcity').find("option").remove();

                        $openCustomerDetailPop.find('#ddlcity').append($("<option></option>").val(0).html('---Select---'));

                        $openCustomerDetailPop.find('#ddlstate').find("option").remove();

                        $openCustomerDetailPop.find('#ddlstate').append($("<option></option>").val(0).html('---Select---'));

                        $.each(data.Records, function (key, value) {

                            $openCustomerDetailPop.find('#ddlstate').append($("<option></option>").val(value.StateID).html(value.StateName));

                        });

                    },
                    error: function (result) {

                    }
                });
            });


            $openCustomerDetailPop.find('#ddlstate').change(function () {
                var option = this.options[this.selectedIndex];
                var sId = $(option).val();

                $.ajax({
                    type: "Get",
                    url: 'Customer/GetCitesName',
                    data: "StateID=" + sId,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    responseType: "json",
                    success: function (data) {
                        $openCustomerDetailPop.find('#ddlcity').find("option").remove();

                        $openCustomerDetailPop.find('#ddlcity').append($("<option></option>").val(0).html('---Select---'));

                        $.each(data.Records, function (key, value) {

                            $openCustomerDetailPop.find('#ddlcity').append($("<option></option>").val(value.CityID).html(value.CityName));

                        });

                    },
                    error: function (result) {

                    }
                });
            });

            $openCustomerDetailPop.find('#btnSubmit').bind('click', function () {

                var CustomerId = CustomerID;
                var CompanyName = $openCustomerDetailPop.find('#txtCompanyName').val();
                var CustomerBarCode = $openCustomerDetailPop.find('#txtCustomerBarCode').val();
                var CustomerCode = $openCustomerDetailPop.find('#txtCustomerCode').val();
                var ContactName = $openCustomerDetailPop.find('#txtContactName').val();
                var ContactTitle = $openCustomerDetailPop.find('#txtContactTitle').val();
                var City = $openCustomerDetailPop.find('#ddlcity').val();
                var Region = $openCustomerDetailPop.find('#txtRegion').val();
                var Country = $openCustomerDetailPop.find('#ddlcountry').val();
                var State = $openCustomerDetailPop.find('#ddlstate').val();
                var PostalCode = $openCustomerDetailPop.find('#txtPostalCode').val();
                var Phone = $openCustomerDetailPop.find('#txtPhone').val();
                var Address = $openCustomerDetailPop.find('#txtAddress').val();

                EditCustomerInformation(CustomerId, CustomerCode, CustomerBarCode, CompanyName, ContactName, ContactTitle, Address, City, Region, PostalCode, Country, Phone, State);


            });

        }

        function bindCountries(target, CountryIDNew) {

            var CountryID = 0;
            $.ajax({
                type: "Get",
                url: 'Customer/GetCountriesName',
                data: "CountryID=" + CountryID,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                responseType: "json",
                success: function (data) {
                    $(target).find("option").remove();

                    $(target).append($("<option></option>").val(0).html('---Select---'));

                    $.each(data.Records, function (key, value) {
                        if (CountryIDNew == value.CountryID) {

                            $(target).append($("<option></option>").val(value.CountryID).html(value.CountryName).attr("selected", true));
                        }
                        else {
                            $(target).append($("<option></option>").val(value.CountryID).html(value.CountryName));
                        }
                    });

                },
                error: function (result) {

                }
            });

        }


        $(document).ready(function () {

        });

        function EditCustomerInformation(CustomerID, CustomerCode, CustomerBarCode, CompanyName, ContactName, ContactTitle, Address, City, Region, PostalCode, Country, Phone, State) {

            $.ajax({
                type: "Get",
                url: 'Customer/EditCustomerInformation',
                //data: "{'CustomerCode':'" + CustomerCode + "','CustomerBarCode':'" + CustomerBarCode + "', 'CompanyName':'" + CompanyName + "', 'ContactName':'" + ContactName + "', 'ContactTitle':'" + ContactTitle + "', 'Address':'" + Address + "', 'City':'" + City + "', 'Region':'" + Region + "', 'PostalCode':'" + PostalCode + "', 'Country':'" + Country + ", 'Phone':'" + Phone + "'', 'CustomerID':" + CustomerID + "}",
                //data: "{'CustomerCode1': + CustomerCode}",
                data: "CustomerCode=" + CustomerCode + "&CustomerBarCode=" + CustomerBarCode + "&CompanyName=" + CompanyName + "&ContactName=" + ContactName + "&ContactTitle=" + ContactTitle + "&Address=" + Address + "&CustomerBarCode=" + CustomerBarCode + "&City=" + City + "&Region=" + Region + "&PostalCode=" + PostalCode + "&Country=" + Country + "&Phone=" + Phone + "&CustomerID=" + CustomerID + "&State=" + State,

                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    alert('hjhj')
                },
                error: function (result) {

                }
            });
        }


    </script>


    <script type="text/javascript">

        $(function () {
            
            bindCountries($('#ddlCountrySearch'), 199);
          
        });



        $(function () {
            $("#btnSearch").click(function () {

      
        var CompanyName = $('#txtCompanyName').val();        
        var CustomerCode = $('#txtCustomerCode').val();
        var ContactName = $('#txtContactName').val();
     
        var City = $('#ddlCitySearch').val();
        var Region = $('#txtRegion').val();
        var Country = $('#ddlCountrySearch').val();
        var State = $('#ddlStateSearch').val();
        var PostalCode = $('#txtPostalCode').val();
        var Phone = $('#txtPhone').val();
        var FromDate = $('#txtFromDate').val();
        var ToDate = $('#txtToDate').val();
        var PostalCode = $('#txtPostalCode').val();

        if (City == 0)
        {

            City = "";
        }

        if (State == 0) {

            State = "";
        }

        if (Country == 0) {

            Country = "";
        }
       
        GetCustomerInformation(CompanyName, CustomerCode, ContactName, Phone, City, State, Country, FromDate, ToDate, PostalCode);
            });
        });

        $(function () {
            $("#btnGet").click(function () {
                GetCustomerInformation();
            });
        });

        function GetCustomerInformation(CompanyName, CustomerCode, ContactName, Phone, City, State, Country, FromDate, ToDate, PostalCode) {

            $('#dvCustomer').jtable({
                title: 'Customer Details',
                paging: true,
                selecting: true,
                pageSize: 10,
                sorting: false,
                columnResizable: false,
                columnSelectable: false,
                customButtons: {
                    items: [
                        {
                            icon: 'Images/edit.png', // used ../default-16x16.png by default
                            text: 'New button',
                            click: function (record) {
                                alert(record);
                            },
                            position: 'left' // right by default
                        }
                    ]
                },

                actions: {
                    listAction: 'Customer/GetStudentMarks',

                    deleteAction: 'Customer/DeleteCustomerInformation'


                },
                recordsLoaded: function (event, data) {

                },
                fields: {

                    CustomerCode: {
                        title: 'Customer Code',
                        width: '30%'
                    },
                    CustomerBarCode: {
                        title: 'Customer Bar Code',
                        width: '30%'
                    },
                    CompanyName: {
                        title: 'Company Name',
                        width: '30%'
                    },
                    ContactName: {
                        title: 'Contact&nbsp;Name',
                        width: '30%'

                    },
                    ContactTitle: {
                        title: 'Contact&nbsp;Title',
                        width: '50%'

                    },
                    Address: {
                        title: 'Address',
                        width: '30%'
                    },
                    Region: {
                        title: 'Region',
                        width: '30%'
                    },

                    CustomerId: {
                        key: true,
                        title: '',
                        width: '3%',
                        display: function (data) {

                            var $edit = $('<img src="Images/edit.png " Title="Edit">');
                            $edit.bind('click', function () {

                                openCustomerDetailPop(data.record.CustomerId);
                                //openCandidateDocuments(data.record.ID, data.record.Name, data.record.EmailID);
                            });

                            return $edit;
                        }

                    }

                }
            });
           
            //$('#dvCustomer').jtable('reload');
            $('#dvCustomer').jtable('load', {
                CompanyName: CompanyName,
                CustomerCode: CustomerCode,
                ContactName: ContactName,
                Phone: Phone,
                City: City,
                State: State,
                Country: Country,
                FromDate: FromDate,
                ToDate: ToDate,               
                PostalCode: PostalCode

            });
        }

        $('#ddlCountrySearch').change(function ()
        {
            var option = this.options[this.selectedIndex];
            var cId = $(option).val();
            bindStateForEdit($('#ddlStateSearch'), cId, 111)
        });

        $('#ddlStateSearch').change(function () {
            var option = this.options[this.selectedIndex];
            var sId = $(option).val();
            bindCityForEdit($('#ddlCitySearch'), sId, 111)
        });

        function bindStateForEdit(target, CountryID, State) {

            
            $.ajax({
                type: "Get",
                url: 'Customer/GetStatesName',
                data: "CountryID=" + CountryID,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                responseType: "json",
                success: function (data) {
                    target.find("option").remove();
                    $(target).append($("<option></option>").val(0).html('---Select---'));

                    $.each(data.Records, function (key, value) {
                        if (State == value.StateID) {
                            $(target).append($("<option></option>").val(value.StateID).html(value.StateName).attr("selected", true));

                        }
                        else {
                            $(target).append($("<option></option>").val(value.StateID).html(value.StateName));
                        }

                    });

                },
                error: function (result) {

                }
            });
        }


        function bindCityForEdit(target, State, City) {

            $.ajax({
                type: "Get",
                url: 'Customer/GetCitesName',
                data: "StateID=" + State,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                responseType: "json",
                success: function (data) {
                    target.find("option").remove();

                    target.append($("<option></option>").val(0).html('---Select---'));

                    $.each(data.Records, function (key, value) {
                        if (City == value.CityID) {
                            target.append($("<option></option>").val(value.CityID).html(value.CityName).attr("selected", true));
                        }
                        else {

                            target.append($("<option></option>").val(value.CityID).html(value.CityName));

                        }
                    });

                },
                error: function (result) {

                }
            });
        }
    </script>
